---
layout: post
categories: datavis
title: ggplot2 - Heat Map
---

在最开始的GGPLOT介绍中，我就拿出了一副热力图
![](/assets/images/ggplot2-heatmap/CEi7DEx.png)

在GGPLOT2中，热力学图也并不是那么复杂，起点并不高。主要用的元素只有两个

- **geom_tile()**
- **geom_raster()**

做好热力学图并不是那么简单，需要很多微调，不过有一个固定的套路我们来一点一点实现

有关geom_tile和geom_raster其实差不多
相对来说geom_raster更有效率，而且在输出中，两个没有特别的分别。只是在输出成PDF时，可能会有小小不同。


首先是R graphics Cookbook中p281页的例子

在完成热力图之前，要把格式改为可以读出的格式。
原数据是这个样子的

<pre>
     Qtr1 Qtr2 Qtr3 Qtr4
1945   NA   87   82   75
1946   63   50   43   32
1947   35   60   54   55
1948   36   39   NA   NA
1949   69   57   57   51
1950   45   37   46   39
1951   36   24   32   23
.
.
.
</pre>


但是我们想要的格式是这样的

<pre>
 	rating	year	quarter
1   NA	    1945	1
2	87		1945	2
3	82		1945	3
4	75		1945	4
5	63		1946	1
6	50		1946	2
 </pre>

这里用到了一个比较投机的方法

{% highlight r %}

    library(ggplot2)
	library(gcookbook)
	pres_rating <- data.frame(
    rating  = as.numeric(presidents),
    year    = as.numeric(floor(time(presidents))),
    quarter = as.numeric(cycle(presidents))
    )

{% endhighlight %}

在数据整合上，有R内置的reshape函数，但是我不太推荐，因为语法比较复杂
推荐：reshape拓展包和pylr拓展包，我写了两个快速教程讲解这两个包，推荐大家看下。


接着用GGPlot2来做热力学图

{% highlight r %}

	# Base plot
	p <- ggplot(pres_rating, aes(x=year, y=quarter, fill=rating))
	# Using geom_tile()
	p + geom_tile()
	# Using geom_raster() - looks the same, but a little more efficient
	p + geom_raster()

{% endhighlight %}

![](/assets/images/ggplot2-heatmap/KfWUIzx.png)

可以看出，真正作图的代码只有一行

我们对此热力学图进行微调

- `scale_y_reverse`:  倒转Y轴
- `scale_x_continuous`:  修改X轴标记
- `scale_fill_gradient2`:  增加中间点的色阶

代码如下

{% highlight r %}
	p + geom_tile() +
    scale_x_continuous(breaks = seq(1940, 1976, by = 4)) +
    scale_y_reverse() +
    scale_fill_gradient2(midpoint=50, mid="grey70", limits=c(0,100))
{% endhighlight %}

![](/assets/images/ggplot2-heatmap/UYiPmd0.png)



- 文中代码和图片下载在： [这里](http://pan.baidu.com/s/1tc26g)








