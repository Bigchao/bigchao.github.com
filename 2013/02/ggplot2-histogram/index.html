<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
                <meta property="wb:webmaster" content="397a4c282ef1bdba" />
		<meta name="description" content="ggplot2 - Histogram | 技术改变世界">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>ggplot2 - Histogram</title>
		<!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/assets/ie.html"><![endif]-->
		<link rel="shortcut icon" href="/assets/images/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="/assets/stylesheets/style.css">
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-45407331-1']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	"		})();
		</script>
		
	</head>
	<body>
		<nav id="nav">
		    <a href="#"><img id="profile" src="/assets/images/profile.png" alt="" height="100" width="100"></a>
			<ul id="menu">
				<li id="label1" class="label selected"><span>最新文章</span></li>
				<li id="label2" class="label"><span>机器学习</span></li>
				<li id="label3" class="label"><span>数据可视化</span></li>
				<li id="label4" class="label"><span>数据挖掘</span></li>
				<li id="label5" class="label"><span>其他技术</span></li>
				<li id="label6" class="label"><span>生活随笔</span></li>
				<a id="about" href="/index.html">关于我</a>
			</ul>

		</nav>

		<aside id="sidebar">
			<div id="title_wrap" class="select1">
				<h2 id="title1" class="title">最新文章</h2>
				<h2 id="title2" class="title">机器学习</h2>
				<h2 id="title3" class="title">数据可视化</h2>
				<h2 id="title4" class="title">数据挖掘</h2>
				<h2 id="title5" class="title">其他技术</h2>
				<h2 id="title6" class="title">生活随笔</h2>
			</div>

			<div id="post_list">
			
				<a class="datavis cate1" href="/2013/11/ggplot2-2d-density"><span class="circle_icon"></span>ggplot2 - 二维数据密度图<span class="date">Nov 2013</span></a>
			
				<a class="datavis cate1" href="/2013/09/Significance-ggplot2"><span class="circle_icon"></span>ggplot2 - 为拟合曲线加置信空间<span class="date">Sep 2013</span></a>
			
				<a class="datavis cate1" href="/2013/05/stack-area-ggplot2"><span class="circle_icon"></span>ggplot2 - Stacked Area Graph<span class="date">May 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/Wilkinson-Dot-Plot"><span class="circle_icon"></span>ggplot2 - Wilkinson Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/heat-map"><span class="circle_icon"></span>ggplot2 - Heat Map<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/cleveland-Dotplot"><span class="circle_icon"></span>ggplot2 - Cleveland Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/ggplot2-line-graph"><span class="circle_icon"></span>ggplot2 - Line Graph<span class="date">Apr 2013</span></a>
			
				<a class="datamining cate1" href="/2013/03/plyr-dataming"><span class="circle_icon"></span>Plyr- 数据整合利器<span class="date">Mar 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-histogram"><span class="circle_icon"></span>ggplot2 - Histogram<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-advanced"><span class="circle_icon"></span>R - Reshape Package II<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-basic"><span class="circle_icon"></span>R - Reshape2 Package<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-bar-chart"><span class="circle_icon"></span>ggplot2 - Barchart<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/intro-ggplot2"><span class="circle_icon"></span>ggplot2 - 作图哲学<span class="date">Jan 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/welcome-ggplot2"><span class="circle_icon"></span>ggplot2 - Welcome!<span class="date">Jan 2013</span></a>
			
			</div>
		</aside>

		<div id="container">
			<div id="pjax">
				
				<article id="post">
	<header id="header">
		<h1 id="identifier">ggplot2 - Histogram</h1>
		<button id="fullscreen" class="header_icon"></button>
		<button id="fontsize" class="header_icon"></button>
	</header>
	<div id="content">
		<p><strong>基本问题</strong>：想做直方图</p>

<ul>
<li><strong>geom_histogram</strong></li>
</ul>


<p><strong>Basic Plot</strong></p>

<div class="highlight"><pre><code class="r">    library<span class="p">(</span>ggplot2<span class="p">)</span>
    library<span class="p">(</span>gcookbook<span class="p">)</span>
    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">()</span>
</code></pre></div>


<p><img src="http://i.imgur.com/wMSbdnr.png" alt="" /></p>

<p>geom_histogram可以对数据框和单一向量做处理，如果想快速看看一个变量的分布是什么样子的可以用下面的代码：</p>

<div class="highlight"><pre><code class="r">    <span class="c1"># Store the values in a simple vector</span>
    w <span class="o">&lt;-</span> faithful<span class="o">$</span>waiting
    ggplot<span class="p">(</span><span class="kc">NULL</span><span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>w<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">()</span>
</code></pre></div>


<p>即把数据框位置设为NULL即可。</p>

<hr />

<p><strong>延伸问题1</strong>: 改变直方图中柱子的个数。
默认中，默认的bin个数是30。
- geom_histogram(binwidth)中修改</p>

<div class="highlight"><pre><code class="r">    <span class="c1"># Divide the x range into 15 bins</span>
    binsize <span class="o">&lt;-</span> diff<span class="p">(</span>range<span class="p">(</span>faithful<span class="o">$</span>waiting<span class="p">))</span><span class="o">/</span><span class="m">15</span>
    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">))</span> <span class="o">+</span>
      geom_histogram<span class="p">(</span>binwidth<span class="o">=</span>binsize<span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/wh9T1UM.png" alt="" /></p>

<hr />

<p><strong>延伸问题2</strong>： 多变量的直方图</p>

<p>如果想观察多变量直方图</p>

<ul>
<li>facet_grid()</li>
<li>map the grouping variable to fill</li>
</ul>


<p><strong>1.facet_grid</strong></p>

<div class="highlight"><pre><code class="r">    library<span class="p">(</span>MASS<span class="p">)</span> <span class="c1"># For the data set</span>
    <span class="c1"># Use smoke as the faceting variable</span>
    ggplot<span class="p">(</span>birthwt<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>bwt<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>fill<span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span> <span class="o">+</span>
      facet_grid<span class="p">(</span>smoke <span class="o">~</span> .<span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/DXoLuNH.png" alt="" /></p>

<p>注意这里有一个小问题，就是Y轴的坐标上限都是一样的。有时会出现如果不同类别的变量绝对值相差很大，图看起来就不够清爽。</p>

<ul>
<li>facet_grid(,scales="free")来修改</li>
</ul>


<div class="highlight"><pre><code class="r">    ggplot<span class="p">(</span>birthwt<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>bwt<span class="p">))</span> <span class="o">+</span> geom_histogram<span class="p">(</span>fill<span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span> <span class="o">+</span>
      facet_grid<span class="p">(</span>race <span class="o">~</span> .<span class="p">,</span> scales<span class="o">=</span><span class="s">&quot;free&quot;</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/2pU3Wiv.png" alt="" /></p>

<p><strong>2.map the grouping variable to fill</strong></p>

<p>把变量放在aes（,fill=)中</p>

<div class="highlight"><pre><code class="r">    birthwt1 <span class="o">&lt;-</span>birthwt <span class="c1"># Make a copy of the data</span>
    <span class="c1"># Convert smoke to a factor</span>
    birthwt1<span class="o">$</span>smoke <span class="o">&lt;-</span> factor<span class="p">(</span>birthwt1<span class="o">$</span>smoke<span class="p">)</span>
    <span class="c1"># Map smoke to fill, make the bars NOT stacked, and make them semitransparent</span>
    ggplot<span class="p">(</span>birthwt1<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>bwt<span class="p">,</span> fill<span class="o">=</span>smoke<span class="p">))</span> <span class="o">+</span>
      geom_histogram<span class="p">(</span>position<span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">,</span> alpha<span class="o">=</span><span class="m">0.4</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/wn5suUY.png" alt="" /></p>

<hr />

<p><strong>延伸问题3</strong>： 为直方图上加密度曲线</p>

<ul>
<li>geom_density()</li>
<li>geom_line(stat="density")</li>
</ul>


<p>首先看看geom_density()的用法</p>

<div class="highlight"><pre><code class="r">    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">))</span> <span class="o">+</span> geom_density<span class="p">()</span>
</code></pre></div>


<p><img src="http://i.imgur.com/fp2Ng9T.png" alt="" /></p>

<p>但是发现在侧边和底部也有黑框包围，不好看。这时候就用到了geom_line()</p>

<div class="highlight"><pre><code class="r">    <span class="c1"># The expand_limits() increases the y range to include the value 0</span>
    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">))</span> <span class="o">+</span> geom_line<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;density&quot;</span><span class="p">)</span> <span class="o">+</span>
      expand_limits<span class="p">(</span>y<span class="o">=</span><span class="m">0</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/VG10TJ6.png" alt="" /></p>

<p>但是援引原书中原句</p>

<blockquote><p>A kernel density curve is an estimate of the population distribution, based on the sample data. The amount of smoothing depends on the kernel bandwidth: the larger the band‐width, the more smoothing there is. The bandwidth can be set with the adjust parameter, which has a default value of 1.</p></blockquote>

<p>感受如下代码</p>

<div class="highlight"><pre><code class="r">    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">))</span> <span class="o">+</span>
    geom_line<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;density&quot;</span><span class="p">,</span> adjust<span class="o">=</span><span class="m">.25</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_line<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;density&quot;</span><span class="p">)</span> <span class="o">+</span>
    geom_line<span class="p">(</span>stat<span class="o">=</span><span class="s">&quot;density&quot;</span><span class="p">,</span> adjust<span class="o">=</span><span class="m">2</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/NMIwC4u.png" alt="" /></p>

<p>我们发现adjust的值越大，曲线就越平滑。
回到最基本的延伸问题：如果想把曲线加到直方图上
- geom_histogram() + geom_density
就可以啦</p>

<div class="highlight"><pre><code class="r">    ggplot<span class="p">(</span>faithful<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>waiting<span class="p">,</span> y<span class="o">=</span>..density..<span class="p">))</span> <span class="o">+</span>
      geom_histogram<span class="p">(</span>fill<span class="o">=</span><span class="s">&quot;cornsilk&quot;</span><span class="p">,</span> colour<span class="o">=</span><span class="s">&quot;grey60&quot;</span><span class="p">,</span> size<span class="o">=</span><span class="m">.2</span><span class="p">)</span> <span class="o">+</span>
      geom_density<span class="p">()</span> <span class="o">+</span>
      xlim<span class="p">(</span><span class="m">35</span><span class="p">,</span> <span class="m">105</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/Q6wvUTN.png" alt="" /></p>

<ul>
<li>文中代码和图片下载在： <a href="http://pan.baidu.com/s/1pEGo8">这里</a></li>
</ul>


		
		<div id="donation">
		如果你喜欢这篇文章，欢迎<a href="https://me.alipay.com/bigchao">捐赠作者</a>以示鼓励。
		</div>
		<div id="social">
		    <a id="weibo" href="http://v.t.sina.com.cn/share/share.php?url=http://yangchao.me/2013/02/ggplot2-histogram&title=ggplot2 - Histogram"></a>
			<a id="twitter" href="https://twitter.com/intent/tweet?url=http://yangchao.me/2013/02/ggplot2-histogram&text=ggplot2 - Histogram"></a>
			<a id="end_cc" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"></a>
		</div>
	</div>
</article>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>



			</div>
		</div>

		<div id="notice">左右滑动</div>
		<script type="text/javascript" src="/assets/js/jquery.js"></script>
		<script type="text/javascript" src="/assets/js/jquery.pjax.js"></script>
		<script type="text/javascript" src="/assets/js/script.js"></script>
		<script type="text/javascript">
		$(document).ready(function(){
        $("#profile").click(function(){
		$.get("sitemap.xml",function(data){
		 var $xml=$(data);
		 url=$xml.find("url")
		 n = url.size()
		 n = getRandom(n)
		 position=url.get(n)
		 location.href =position.find("loc").text()
	
  })
	
})
	//随机数发生器
       function getRandom(n){return Math.floor(Math.random()*(n+1))}
});
		</script>
		
	</body>
</html>
