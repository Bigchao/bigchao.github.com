<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
                <meta property="wb:webmaster" content="397a4c282ef1bdba" />
		<meta name="description" content="ggplot2 - Heat Map | 技术改变世界">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>ggplot2 - Heat Map</title>
		<!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/assets/ie.html"><![endif]-->
		<link rel="shortcut icon" href="/assets/images/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="/assets/stylesheets/style.css">
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-45407331-1']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	"		})();
		</script>
		
	</head>
	<body>
		<nav id="nav">
			<img id="profile" src="/assets/images/profile.png" alt="" height="100" width="100">
			<ul id="menu">
				<li id="label1" class="label selected"><span>最新文章</span></li>
				<li id="label2" class="label"><span>机器学习</span></li>
				<li id="label3" class="label"><span>数据可视化</span></li>
				<li id="label4" class="label"><span>数据挖掘</span></li>
				<li id="label5" class="label"><span>其他技术</span></li>
				<li id="label6" class="label"><span>生活随笔</span></li>
				<a id="about" href="/index.html">关于我</a>
			</ul>

		</nav>

		<aside id="sidebar">
			<div id="title_wrap" class="select1">
				<h2 id="title1" class="title">最新文章</h2>
				<h2 id="title2" class="title">机器学习</h2>
				<h2 id="title3" class="title">数据可视化</h2>
				<h2 id="title4" class="title">数据挖掘</h2>
				<h2 id="title5" class="title">其他技术</h2>
				<h2 id="title6" class="title">生活随笔</h2>
			</div>

			<div id="post_list">
			
				<a class="datavis cate1" href="/2013/11/ggplot2-2d-density"><span class="circle_icon"></span>ggplot2 - 二维数据密度图<span class="date">Nov 2013</span></a>
			
				<a class="datavis cate1" href="/2013/09/Significance-ggplot2"><span class="circle_icon"></span>ggplot2 - 为拟合曲线加置信空间<span class="date">Sep 2013</span></a>
			
				<a class="datavis cate1" href="/2013/05/stack-area-ggplot2"><span class="circle_icon"></span>ggplot2 - Stacked Area Graph<span class="date">May 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/Wilkinson-Dot-Plot"><span class="circle_icon"></span>ggplot2 - Wilkinson Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/heat-map"><span class="circle_icon"></span>ggplot2 - Heat Map<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/cleveland-Dotplot"><span class="circle_icon"></span>ggplot2 - Cleveland Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/ggplot2-line-graph"><span class="circle_icon"></span>ggplot2 - Line Graph<span class="date">Apr 2013</span></a>
			
				<a class="datamining cate1" href="/2013/03/plyr-dataming"><span class="circle_icon"></span>Plyr- 数据整合利器<span class="date">Mar 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-histogram"><span class="circle_icon"></span>ggplot2 - Histogram<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-advanced"><span class="circle_icon"></span>R - Reshape Package II<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-basic"><span class="circle_icon"></span>R - Reshape2 Package<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-bar-chart"><span class="circle_icon"></span>ggplot2 - Barchart<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/intro-ggplot2"><span class="circle_icon"></span>ggplot2 - 作图哲学<span class="date">Jan 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/welcome-ggplot2"><span class="circle_icon"></span>ggplot2 - Welcome!<span class="date">Jan 2013</span></a>
			
			</div>
		</aside>

		<div id="container">
			<div id="pjax">
				<article id="post">
	<header id="header">
		<h1 id="identifier">ggplot2 - Heat Map</h1>
		<button id="fullscreen" class="header_icon"></button>
		<button id="fontsize" class="header_icon"></button>
	</header>
	<div id="content">
		<p>在最开始的GGPLOT介绍中，我就拿出了一副热力图
<img src="http://i.imgur.com/CEi7DEx.png" alt="" /></p>

<p>在GGPLOT2中，热力学图也并不是那么复杂，起点并不高。主要用的元素只有两个</p>

<ul>
<li><strong>geom_tile()</strong></li>
<li><strong>geom_raster()</strong></li>
</ul>


<p>做好热力学图并不是那么简单，需要很多微调，不过有一个固定的套路我们来一点一点实现</p>

<p>有关geom_tile和geom_raster其实差不多
相对来说geom_raster更有效率，而且在输出中，两个没有特别的分别。只是在输出成PDF时，可能会有小小不同。</p>

<p>首先是R graphics Cookbook中p281页的例子</p>

<p>在完成热力图之前，要把格式改为可以读出的格式。
原数据是这个样子的</p>

<pre>
     Qtr1 Qtr2 Qtr3 Qtr4
1945   NA   87   82   75
1946   63   50   43   32
1947   35   60   54   55
1948   36   39   NA   NA
1949   69   57   57   51
1950   45   37   46   39
1951   36   24   32   23
.
.
.
</pre>


<p>但是我们想要的格式是这样的</p>

<pre>
    rating  year    quarter
1   NA      1945    1
2   87      1945    2
3   82      1945    3
4   75      1945    4
5   63      1946    1
6   50      1946    2
 </pre>


<p>这里用到了一个比较投机的方法</p>

<div class="highlight"><pre><code class="r">    library<span class="p">(</span>ggplot2<span class="p">)</span>
    library<span class="p">(</span>gcookbook<span class="p">)</span>
    pres_rating <span class="o">&lt;-</span> data.frame<span class="p">(</span>
    rating  <span class="o">=</span> as.numeric<span class="p">(</span>presidents<span class="p">),</span>
    year    <span class="o">=</span> as.numeric<span class="p">(</span>floor<span class="p">(</span>time<span class="p">(</span>presidents<span class="p">))),</span>
    quarter <span class="o">=</span> as.numeric<span class="p">(</span>cycle<span class="p">(</span>presidents<span class="p">))</span>
    <span class="p">)</span>
</code></pre></div>


<p>在数据整合上，有R内置的reshape函数，但是我不太推荐，因为语法比较复杂
推荐：reshape拓展包和pylr拓展包，我写了两个快速教程讲解这两个包，推荐大家看下。</p>

<p>接着用GGPlot2来做热力学图</p>

<div class="highlight"><pre><code class="r">    <span class="c1"># Base plot</span>
    p <span class="o">&lt;-</span> ggplot<span class="p">(</span>pres_rating<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>year<span class="p">,</span> y<span class="o">=</span>quarter<span class="p">,</span> fill<span class="o">=</span>rating<span class="p">))</span>
    <span class="c1"># Using geom_tile()</span>
    p <span class="o">+</span> geom_tile<span class="p">()</span>
    <span class="c1"># Using geom_raster() - looks the same, but a little more efficient</span>
    p <span class="o">+</span> geom_raster<span class="p">()</span>
</code></pre></div>


<p><img src="http://i.imgur.com/KfWUIzx.png" alt="" /></p>

<p>可以看出，真正作图的代码只有一行</p>

<p>我们对此热力学图进行微调</p>

<ul>
<li><code>scale_y_reverse</code>:  倒转Y轴</li>
<li><code>scale_x_continuous</code>:  修改X轴标记</li>
<li><code>scale_fill_gradient2</code>:  增加中间点的色阶</li>
</ul>


<p>代码如下</p>

<div class="highlight"><pre><code class="r">    p <span class="o">+</span> geom_tile<span class="p">()</span> <span class="o">+</span>
    scale_x_continuous<span class="p">(</span>breaks <span class="o">=</span> seq<span class="p">(</span><span class="m">1940</span><span class="p">,</span> <span class="m">1976</span><span class="p">,</span> by <span class="o">=</span> <span class="m">4</span><span class="p">))</span> <span class="o">+</span>
    scale_y_reverse<span class="p">()</span> <span class="o">+</span>
    scale_fill_gradient2<span class="p">(</span>midpoint<span class="o">=</span><span class="m">50</span><span class="p">,</span> mid<span class="o">=</span><span class="s">&quot;grey70&quot;</span><span class="p">,</span> limits<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">))</span>
</code></pre></div>


<p><img src="http://i.imgur.com/UYiPmd0.png" alt="" /></p>


		<div id="social">
		    <a id="weibo" href="http://v.t.sina.com.cn/share/share.php?url=http://yangchao.me/2013/04/heat-map&title=ggplot2 - Heat Map"></a>
			<a id="twitter" href="https://twitter.com/intent/tweet?url=http://yangchao.me/2013/04/heat-map&text=ggplot2 - Heat Map"></a>
			<a id="end_cc" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"></a>
			
			</div>
	</div>
</article>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
			</div>
		</div>

		<div id="notice">左右滑动</div>
		<script type="text/javascript" src="/assets/js/jquery.js"></script>
		<script type="text/javascript" src="/assets/js/jquery.pjax.js"></script>
		<script type="text/javascript" src="/assets/js/script.js"></script>
		<script type="text/javascript">
		$(document).ready(function(){
         $("#profile").click(function(){
		$.get('/sitemap.xml',function(data){
		 var $xml=$(data);
		 url=$xml.find("url")
		 n = url.size()
		 n = getRandom(n)
		 position=url.get(n)
		 location.href =position.find("loc").text()
	
  })
	
})
	//随机数发生器
       function getRandom(n){return Math.floor(Math.random()*(n+1))}
});
		</script>
		
	</body>
</html>
