<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
                <meta property="wb:webmaster" content="397a4c282ef1bdba" />
		<meta name="description" content="scrapy初探-安装和简单操作 | 技术改变世界">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<title>scrapy初探-安装和简单操作</title>
		<!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/assets/ie.html"><![endif]-->
		<link rel="shortcut icon" href="/assets/images/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="/assets/stylesheets/style.css">
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-45407331-1']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	"		})();
		</script>
		
	</head>
	<body>
		<nav id="nav">
		    <a id="random" href="#"><img id="profile" src="/assets/images/profile.png" alt="" height="100" width="100"></a>
			<ul id="menu">
				<li id="label1" class="label selected"><span>最新文章</span></li>
				<li id="label2" class="label"><span>机器学习</span></li>
				<li id="label3" class="label"><span>数据可视化</span></li>
				<li id="label4" class="label"><span>数据挖掘</span></li>
				<li id="label5" class="label"><span>其他技术</span></li>
				<li id="label6" class="label"><span>生活随笔</span></li>
				<a id="about" href="/index.html">关于我</a>
			</ul>

		</nav>

		<aside id="sidebar">
			<div id="title_wrap" class="select1">
				<h2 id="title1" class="title">最新文章</h2>
				<h2 id="title2" class="title">机器学习</h2>
				<h2 id="title3" class="title">数据可视化</h2>
				<h2 id="title4" class="title">数据挖掘</h2>
				<h2 id="title5" class="title">其他技术</h2>
				<h2 id="title6" class="title">生活随笔</h2>
			</div>

			<div id="post_list">
			
				<a class="related cate1" href="/2014/03/mathjax-github"><span class="circle_icon"></span>在Github中使用MathJax编辑公式<span class="date">Mar 2014</span></a>
			
				<a class=" cate1" href="/2014/03/data-table"><span class="circle_icon"></span>Data Table<span class="date">Mar 2014</span></a>
			
				<a class="datamining cate1" href="/2014/03/python-re-sub"><span class="circle_icon"></span>python正则表达式：re.sub<span class="date">Mar 2014</span></a>
			
				<a class="datamining cate1" href="/2014/03/python-regular-expression"><span class="circle_icon"></span>python正则表达式<span class="date">Mar 2014</span></a>
			
				<a class="datamining cate1" href="/2014/03/install-scrapy"><span class="circle_icon"></span>scrapy初探-安装和简单操作<span class="date">Mar 2014</span></a>
			
				<a class="datamining cate1" href="/2014/02/where-is-data"><span class="circle_icon"></span>数据都去哪儿了<span class="date">Feb 2014</span></a>
			
				<a class="related cate1" href="/2014/02/douban"><span class="circle_icon"></span>烟波至爽，数据为王<span class="date">Feb 2014</span></a>
			
				<a class="life cate1" href="/2013/12/happy-new-year"><span class="circle_icon"></span>Happy New Year<span class="date">Dec 2013</span></a>
			
				<a class="datavis cate1" href="/2013/11/ggplot2-2d-density"><span class="circle_icon"></span>ggplot2 - 二维数据密度图<span class="date">Nov 2013</span></a>
			
				<a class="datavis cate1" href="/2013/10/horizon-lattice-extra"><span class="circle_icon"></span>latticeExtra - Horizon Plot的简单实现<span class="date">Oct 2013</span></a>
			
				<a class="datavis cate1" href="/2013/10/horizon-plot"><span class="circle_icon"></span>Horizon Chart - 惊艳到爆的哲学<span class="date">Oct 2013</span></a>
			
				<a class="datavis cate1" href="/2013/09/Significance-ggplot2"><span class="circle_icon"></span>ggplot2 - 为拟合曲线加置信空间<span class="date">Sep 2013</span></a>
			
				<a class="life cate1" href="/2013/06/mj-memory"><span class="circle_icon"></span>再次纪念MJ<span class="date">Jun 2013</span></a>
			
				<a class="datamining cate1" href="/2013/06/plyr-advanced"><span class="circle_icon"></span>Plyr- 多因子整合<span class="date">Jun 2013</span></a>
			
				<a class="datavis cate1" href="/2013/05/stack-area-ggplot2"><span class="circle_icon"></span>ggplot2 - Stacked Area Graph<span class="date">May 2013</span></a>
			
				<a class="related cate1" href="/2013/05/Sublime-text-2"><span class="circle_icon"></span>Sublime Text 2学习过程<span class="date">May 2013</span></a>
			
				<a class="ml cate1" href="/2013/04/mahout-big-data"><span class="circle_icon"></span>Mahout简单部署备忘<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/Wilkinson-Dot-Plot"><span class="circle_icon"></span>ggplot2 - Wilkinson Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/heat-map"><span class="circle_icon"></span>ggplot2 - Heat Map<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/cleveland-Dotplot"><span class="circle_icon"></span>ggplot2 - Cleveland Dot Plot<span class="date">Apr 2013</span></a>
			
				<a class="datavis cate1" href="/2013/04/ggplot2-line-graph"><span class="circle_icon"></span>ggplot2 - Line Graph<span class="date">Apr 2013</span></a>
			
				<a class="datamining cate1" href="/2013/03/plyr-dataming"><span class="circle_icon"></span>Plyr- 数据整合利器<span class="date">Mar 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-histogram"><span class="circle_icon"></span>ggplot2 - Histogram<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-advanced"><span class="circle_icon"></span>R - Reshape Package II<span class="date">Feb 2013</span></a>
			
				<a class="datamining cate1" href="/2013/02/reshape-basic"><span class="circle_icon"></span>R - Reshape2 Package<span class="date">Feb 2013</span></a>
			
				<a class="related cate1" href="/2013/02/hadoop-hive"><span class="circle_icon"></span>大数据体验之Hadoop, Rhadoop, 和Hive<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/02/ggplot2-bar-chart"><span class="circle_icon"></span>ggplot2 - Barchart<span class="date">Feb 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/intro-ggplot2"><span class="circle_icon"></span>ggplot2 - 作图哲学<span class="date">Jan 2013</span></a>
			
				<a class="datavis cate1" href="/2013/01/welcome-ggplot2"><span class="circle_icon"></span>ggplot2 - Welcome!<span class="date">Jan 2013</span></a>
			
				<a class="life cate1" href="/2012/08/story-vision"><span class="circle_icon"></span>自己的视角，别人的故事<span class="date">Aug 2012</span></a>
			
				<a class="life cate1" href="/2012/06/memorize-michael-jackson"><span class="circle_icon"></span>纪念 Michael Jackson - This Is It<span class="date">Jun 2012</span></a>
			
				<a class="life cate1" href="/2012/06/happy-madives"><span class="circle_icon"></span>传说中的马尔代夫<span class="date">Jun 2012</span></a>
			
				<a class="life cate1" href="/2011/03/japan-earthquake"><span class="circle_icon"></span>日本地震杂想<span class="date">Mar 2011</span></a>
			
			</div>
		</aside>

		<div id="container">
			<div id="pjax">
				
				<article id="post">
	<header id="header">
		<h1 id="identifier">scrapy初探-安装和简单操作</h1>
		<button id="fullscreen" class="header_icon"></button>
		<button id="fontsize" class="header_icon"></button>
	</header>
	<div id="content">
		<p>最近因为要抓取一些网页，所以搜索一些工具来实现。当然最熟悉的R也可以胜任这个事儿，比如Rcurl和XML的包都行。但是其功能还是挺受局限的，尤其和Python相比，就差的比较多了。</p>

<p>Python的beautiful soup库其实也很不错。但是Scrapy似乎很炫的样子，不少人和我推荐了。所以就趁着项目之前的筹备期先学起来。</p>

<p>首先是安装。</p>

<p>– Windows</p>

<p>我的电脑是windows8.1, 安装的时候我参考了多个网上的版本。用了将近两天时间，最后宣告失败。就是装不上。</p>

<p>要说现在留在windows的最重要理由就是SAS了。</p>

<p>– Mac</p>

<p>Mac上安装其实则方便很多。</p>

<p>但是事情没有我想象的那么简单，在Mac上安装也耗费了我不少的时间。一度情绪相当低落相当崩溃。</p>

<p>因为Mac自带了Python2.7.5所以当时我就直接用这个版本的python了。然后安装了pip，然后按照</p>

<div class="highlight"><pre><code class="python">	<span class="n">pip</span> <span class="n">install</span> <span class="n">scrapy</span>
</code></pre></div>

<p>就可以了。就不是不行。</p>

<p>后来出现了其他诸多问题。</p>

<p>最后的办法就是所有都推到重新来，</p>

<ol>
  <li>安装了Homebrew，开始homebrew都安装不了，一度非常崩溃，更新了Xcode最新版之后可以了</li>
  <li>brew python</li>
</ol>

<p>然后一点点就可以了。</p>

<p>安装过程整整花了我两天时间，当最后可以使用的时候已经身心俱疲了。</p>

<p>下面就是使用过程。</p>

<p>整个的scrapy的构架和Django有点像，有人更是说其中的机制是模仿了Django。先建立一个工程然后把要提取的放到不同的文件里。代码量并不大。而且很方便。</p>

<p>下面简单走一个流程，看看scrapy是怎么运作的？</p>

<h3 id="section">找一个要抓取的网站</h3>

<p>按照官方放的教程，我就以<code>mininova</code>为例</p>

<p><a href="">http://www.mininova.org/today</a></p>

<h3 id="section-1">定义我们要抓取的内容</h3>

<p>我们想文件的url，名称，描述，和大小。所以在项目文件夹下的<code>item.py</code>中添加以下内容</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">scrapy.item</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">TorrentItem</span><span class="p">(</span><span class="n">Item</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div>

<h3 id="section-2">定义爬虫</h3>
<p>定制爬虫就是定义如何搜索链接和如何选取其中的数据。其中需要用到Xpath和正则的知识。</p>

<p>首先分析页面内容：</p>

<p><a href="">http://www.mininova.org/tor/2676093</a></p>

<p>比如这个网站</p>

<p>Chrom可以直接观源代码</p>

<h5 id="tag-h1-">文件名称在tag h1 中</h5>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;h1&gt;</span>Darwin - The Evolution Of An Exhibition<span class="nt">&lt;/h1&gt;</span>
</code></pre></div>

<p>提取应该这样：
<code>//h1/text()</code></p>

<h5 id="div-tag-with-iddescription">描述在 &lt;div&gt; tag with id=”description”:</h5>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;h2&gt;</span>Description:<span class="nt">&lt;/h2&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>
Short documentary made for Plymouth City Museum and Art Gallery regarding the setup of an exhibit about Charles Darwin in conjunction with the 200th anniversary of his birth.

...
</code></pre></div>

<p>所以Xpath就应该是这样：</p>

<p><code>//div[@id='description']</code></p>

<h5 id="section-3">最后，有关文件大小</h5>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;specifications&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;strong&gt;</span>Category:<span class="nt">&lt;/strong&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/cat/4&quot;</span><span class="nt">&gt;</span>Movies<span class="nt">&lt;/a&gt;</span> <span class="ni">&amp;gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/sub/35&quot;</span><span class="nt">&gt;</span>Documentary<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;strong&gt;</span>Total size:<span class="nt">&lt;/strong&gt;</span>
150.62<span class="ni">&amp;nbsp;</span>megabyte<span class="nt">&lt;/p&gt;</span>
</code></pre></div>

<p>Xpath提取就应该是这样的：</p>

<p><code>//div[@id='specifications']/p[2]/text()[2]</code></p>

<p>最后爬虫文件应该长这个样子：</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">scrapy.contrib.spiders</span> <span class="kn">import</span> <span class="n">CrawlSpider</span><span class="p">,</span> <span class="n">Rule</span>
<span class="kn">from</span> <span class="nn">scrapy.contrib.linkextractors.sgml</span> <span class="kn">import</span> <span class="n">SgmlLinkExtractor</span>
<span class="kn">from</span> <span class="nn">scrapy.selector</span> <span class="kn">import</span> <span class="n">Selector</span>

<span class="k">class</span> <span class="nc">MininovaSpider</span><span class="p">(</span><span class="n">CrawlSpider</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;mininova&#39;</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mininova.org&#39;</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http://www.mininova.org/today&#39;</span><span class="p">]</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rule</span><span class="p">(</span><span class="n">SgmlLinkExtractor</span><span class="p">(</span><span class="n">allow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;/tor/\d+&#39;</span><span class="p">]),</span> <span class="s">&#39;parse_torrent&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">parse_torrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">torrent</span> <span class="o">=</span> <span class="n">TorrentItem</span><span class="p">()</span>
        <span class="n">torrent</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">url</span>
        <span class="n">torrent</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&quot;//h1/text()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">torrent</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&quot;//div[@id=&#39;description&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">torrent</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&quot;//div[@id=&#39;info-left&#39;]/p[2]/text()[2]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">torrent</span>
</code></pre></div>

<div class="highlight"><pre><code class="python"><span class="n">scrapy</span> <span class="n">crawl</span> <span class="n">mininova</span> <span class="o">-</span><span class="n">o</span> <span class="n">scraped_data</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">t</span> <span class="n">json</span>
</code></pre></div>

<p>最后保存的数据为jason格式。</p>

<div class="highlight"><pre><code class="html">[{&quot;url&quot;: &quot;http://www.mininova.org/tor/2676093&quot;, &quot;name&quot;: [&quot;Darwin - The Evolution Of An Exhibition&quot;], &quot;description&quot;: [&quot;Short documentary made for Plymouth ...&quot;], &quot;size&quot;: [&quot;150.62 megabyte&quot;]},
# ... other items ...
]
</code></pre></div>

<h2 id="section-4">参考</h2>
<p><a href="http://scrapy.org/">scrapy</a></p>

		
		<div id="donation">
		<b><a href="https://me.alipay.com/bigchao">Buy Me A Drink!</a>>, Come on!:)</b>
		</div>
		<div id="social">
		    <a id="weibo" href="http://v.t.sina.com.cn/share/share.php?url=http://yangchao.me/2014/03/install-scrapy&title=scrapy初探-安装和简单操作"></a>
			<a id="twitter" href="https://twitter.com/intent/tweet?url=http://yangchao.me/2014/03/install-scrapy&text=scrapy初探-安装和简单操作"></a>
			<a id="end_cc" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"></a>
		</div>
	</div>
</article>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>



			</div>
		</div>

		<div id="notice">左右滑动</div>
		<script type="text/javascript" src="/assets/js/jquery.js"></script>
		<script type="text/javascript" src="/assets/js/jquery.pjax.js"></script>
		<script type="text/javascript" src="/assets/js/script.js"></script>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}},
        "HTML-CSS": {linebreaks: {automatic: true}},
        SVG: {linebreaks: {automatic: true}}
        });
        </script>
		<script>
		$(document).ready(function(){
		$("#random").on('click','img',function(){
			$.get("sitemap.xml",function(data){
			var $xml=$(data);
			url=$xml.find("url");
			n = url.size();
			n = getRandom(n);
			position=url.get(n);  
			hello=position.getElementsByTagName("loc")[0].firstChild.nodeValue; 
			location.href=hello;
		})
    
	})
  //随机数发生器
       function getRandom(n){return Math.floor(Math.random()*(n+1))}
})
	</script>
		
	</body>
</html>
